---
title: 什么是文件描述符？
category: Node.js
date: 2025-07-09 20:14
difficulty: 中等
excerpt: 文件描述符是操作系统用于标识打开文件或 I/O 资源的非负整数索引，常在 Node.js 中使用。
tags:
- 文件描述符
- 系统编程
- 系统
---
文件描述符 (File Descriptor) 是操作系统中用于标识打开文件或 I/O 资源的非负整数索引。它用于统一处理文件读写等操作，在 Node.js 环境下常通过 `fs` 模块或系统调用操作。主要特点如下：

1.  **定义与核心属性**  
    - 非负整数标识：文件描述符为进程提供统一资源引用。
    - 内核维护索引：指向系统级文件表 (储存 I/O 访问位置、权限等属性)。
    - 进程私有文件描述符表：不同进程可使用相同数字指代不同资源。

2.  **默认分配资源**  
    每个进程预分配三种特殊文件描述符：
    - `0` (STDIN\_FILENO)：标准输入 stdin (默认为键盘)。
    - `1` (STDOUT\_FILENO)：标准输出 stdout (默认为屏幕输出)。
    - `2` (STDERR\_FILENO)：标准错误 stderr (错误信息输出通道)。

3.  **常用操作方式**  
    - 使用系统调用 (Node.js 通过 `openSync()`)：
      ```c
      #include <fcntl.h>
      int fd = open("file.txt", O_RDONLY); // 打开文件返回描述符
      // 执行读写操作
      close(fd); // 关闭释放资源
      ```
    - 最小未使用分配：系统分配时优先取空闲最小数字 (例如若文件描述符`4`关闭后新文件占用 `4`)。

4.  **性能与安全注意事项**  
    - **限制与溢出**：每个进程默认限制为 1024 个；超限触发错误导致溢出现象：
        ```
        "Too many open files" // 进程级别错误 EMFILE/ 系统级别 ENFILE
        ```
    - **避免溢出办法**：
        - 及时 `close()` 文件描述符。
        - 核查系统调用返回值避免连续创建。
        - 配置提高最大文件限制 (例如通过 `ulimit -n`)。
